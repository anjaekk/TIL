ì‚¬ìš©ìžê°€ ì›¹ì— íšŒì›ê°€ìž…í•˜ê³  ë¡œê·¸ì¸í•  ë•Œ íŒ¨ìŠ¤ì›Œë“œì˜ ì•”í˜¸í™”ëŠ” í•„ìˆ˜ì ì´ë‹¤. ì•”í˜¸í™”ë¥¼ í•˜ì§€ ì•Šì„ ê²½ìš° DBê°€ í•´í‚¹ì„ ë‹¹í•˜ë©´ ìœ ì €ì˜ íŒ¨ìŠ¤ì›Œë“œë„ ê·¸ëŒ€ë¡œ ë…¸ì¶œ ë˜ê²Œ ë˜ê³  ê¼­ ì™¸ë¶€ í•´í‚¹ì´ ì•„ë‹ˆë”ë¼ë„ ë‚´ë¶€ ì¸ë ¥ì´ ì‚¬ìš©ìžì˜ íŒ¨ìŠ¤ì›Œë“œë¥¼ ë´ì„œëŠ” ì•ˆë˜ê¸° ë•Œë¬¸ì´ë‹¤. ê·¸ëŸ¬ë¯€ë¡œ í•„ížˆ ì•”í˜¸í™”ë¥¼ í•´ì„œ ì €ìž¥í•´ì•¼í•œë‹¤. 

## 1. ë‹¨ë°©í–¥ í•´ì‰¬ í•¨ìˆ˜(one-way hash function)
íŒ¨ìŠ¤ì›Œë“œ ì•”í˜¸ì—ëŠ” ë‹¨ë°©í–¥ í•´ì‰¬ í•¨ìˆ˜(one-way hash function)ê°€ ì¼ë°˜ì ìœ¼ë¡œ ì“°ì¸ë‹¤. ë§ ê·¸ëŒ€ë¡œ í•¨ìˆ˜ë¡œì¨ inputì„ ë„£ìœ¼ë©´ ì•”í˜¸í™”ëœ outputì´ ë‚˜ì˜¤ê²Œ ëœë‹¤. ë³¸ëž˜ í•´ì‰¬ í•¨ìˆ˜ëŠ” ìžë£Œêµ¬ì¡°ì—ì„œ ë¹ ë¥¸ ìžë£Œì˜ ê²€ìƒ‰ì´ë‚˜ ë°ì´í„°ì˜ ìœ„ë³€ì¡° ì²´í¬ë¥¼ ìœ„í•´ ì“°ì´ì§€ë§Œ **ë³µì›ì´ ë¶ˆê°€ëŠ¥**í•œ í•´ì‰¬í•¨ìˆ˜ëŠ” ì•”í˜¸í•™ì  ìš©ë„ë¡œ ì‚¬ìš©í•œë‹¤. 

## 2. ë‹¤ì´ì œìŠ¤íŠ¸(digest)
ë‹¨ë°©í–¥ **í•´ì‹œí•¨ìˆ˜ëŠ” ì›ë³¸ ë©”ì‹œì§€ë¥¼ ë°˜í™˜í•˜ì—¬ ì•”í˜¸í™”ëœ ë©”ì„¸ì§€ì¸ ë‹¤ì´ì œìŠ¤íŠ¸(digest)ë¥¼ ìƒì„±**í•œë‹¤. ì•”í˜¸í™”ëœ ë©”ì„¸ì§€ëŠ” ì›ë³¸ ë©”ì„¸ì§€ë¥¼ êµ¬í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— `ë‹¨ë°©í–¥ì„±(one-way)`ë¼ê³  í•œë‹¤.

- **í•´ì‰¬í•¨ìˆ˜ ì‚¬ìš© ì˜ˆ**
```
>>> import hashlib
>>> hassed_message = hashlib.sha256()
>>> hassed_message.update(b"password")
>>> hassed_message.hexdigest()
'5e884898da28047151d0e56f8dc6292773603d0d6aabbdd62a11ef721d1542d8'
```

## 3. ë‹¨ë°©í–¥ í•´ì‰¬ í•¨ìˆ˜ì˜ í•œê³„
ë‹¨ë°©í–¥ í•´ì‰¬í•¨ìˆ˜ë¡œ ì•”í˜¸í™”ë¥¼ í•˜ëŠ”ë° ìžˆì–´ í•œê³„ì ì´ ìžˆë‹¤ë©´ ë™ì¼í•œ **ì›ë³¸ ë©”ì„¸ì§€ëŠ” ë™ì¼í•œ ë‹¤ì´ì œìŠ¤íŠ¸ë¥¼ ì–»ëŠ” ë‹¤ëŠ” ê²ƒ**ì´ë‹¤. ë˜í•œ ìœ„ì—ë„ ì–¸ê¸‰í–ˆì§€ë§Œ í•´ì‰¬í•¨ìˆ˜ëŠ” ì›ëž˜ íŒ¨ìŠ¤ì›Œë“œë¥¼ ì €ìž¥í•˜ê¸° ìœ„í•´ ì„¤ê³„ëœ ê²ƒì´ ì•„ë‹Œ ì§§ì€ ì‹œê°„ì— ë°ì´í„°ë¥¼ ê²€ìƒ‰í•˜ê¸° ìœ„í•´ ì„¤ê³„ëœ ê²ƒìœ¼ë¡œ **ì²˜ë¦¬ ì†ë„ê°€ ë§¤ìš° ë¹ ë¥´ê²Œ ì„¤ê³„**ë˜ì—ˆë‹¤. ì´ë ‡ë‹¤ë³´ë‹ˆ **ê³µê²©ìž(í•´ì»¤)ì˜ ìž…ìž¥ì—ì„œ ìž„ì˜ì˜ ë¬¸ìžì—´ ë‹¤ì´ì œìŠ¤íŠ¸ì™€ í•´í‚¹í•  ëŒ€ìƒì˜ ë‹¤ì´ì œìŠ¤íŠ¸ë¥¼ ë¹„êµí•˜ì—¬ í•´ì‹±ëœ ë‹¤ì´ì œìŠ¤íŠ¸ì˜ ì›ë¬¸ì„ ì•Œì•„ë‚¼ ìˆ˜ ìžˆë‹¤.** ì´ë ‡ë‹¤ë©´ íŒ¨ìŠ¤ì›Œë“œê°€ ì¶©ë¶„ížˆ ê¸¸ì§€ ì•Šê±°ë‚˜ ê°„ë‹¨í•  ë•ŒëŠ” ê·¸ë¦¬ ê¸´ ì‹œê°„ì´ ê±¸ë¦¬ì§€ ì•Šê²Œ ë  ê²ƒì´ë‹¤. ì´ë ‡ê²Œ ë‹¤ì´ì œìŠ¤íŠ¸ë¥¼ ëª¨ì•„ë†“ì€ í…Œì´ë¸”ì„ `ë ˆì¸ë³´ìš° í…Œì´ë¸”(Rainbow Table)` ì´ë¼ê³  í•œë‹¤. 

## 4. í•œê³„ ë³´ì™„
ë‹¨ë°©í–¥ í•´ì‰¬ í•¨ìˆ˜ì˜ í•œê³„ë¥¼ ë³´ì™„í•˜ê¸°ìœ„í•´ ì¼ë°˜ì ìœ¼ë¡œ `Salting`, `Key Stretching` 2ê°€ì§€ ë³´ì™„ì ì´ ì‚¬ìš©ëœë‹¤. 
### 1) Salting
`Salting`ì€ í•´ì‰¬í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ê¸° ì „ì— ì›ë¬¸ì— ìž„ì˜ì˜ ë¬¸ìžì—´ì„ ë§ë¶™ì—¬ í•´ì‹œê°’ì„ ê³„ì‚°í•˜ëŠ” ë°©ë²•ì´ë‹¤. ì´ë ‡ê²Œ í•˜ê²Œë˜ë©´ ê³µê²©ìžê°€ ë‹¤ì´ì œìŠ¤íŠ¸ë¥¼ ì•Œì•„ë‚´ë”ë¼ë„ íŒ¨ìŠ¤ì›Œë“œëŠ” ì•Œì•„ë‚´ê¸° ì–´ë ¤ì›Œì§„ë‹¤. 

### 2) Key Stretching
`Key Stretching`ì€ ë‹¨ë°©í–¥ í•´ì‰¬ê°’ì„ ê³„ì‚°í•˜ê³  ê·¸ í•´ì‰¬ê°’ì— ë˜ í•´ì‹±í•˜ëŠ” ê²ƒì²˜ëŸ¼ í•´ì‹±ì„ ë°˜ë³µí•˜ëŠ” ê²ƒì„ ë§í•œë‹¤. ë¬¼ë¡  í•´ì‹±ì˜ ë°˜ë³µíšŸìˆ˜ëŠ” ë…¸ì¶œë˜ì§€ ì•Šë„ë¡ í•´ì•¼í•˜ì§€ë§Œ ì•Œê²Œë˜ë”ë¼ë„ íŒ¨ìŠ¤ì›Œë“œ ì›ë¬¸ì„ ì•Œì•„ë‚´ê¸°ê¹Œì§€ì˜ ì‹œê°„ì´ ì˜¤ëž˜ê±¸ë¦¬ê²Œ ë  ê²ƒì´ë‹¤. 

![](https://images.velog.io/images/anjaekk/post/7dee0b0d-ab3a-4ea3-9380-5348545cc5ad/image.png)

> ðŸ“ [ì´ë¯¸ì§€ ì¶œì²˜: egovframework:rte:fdl:encryption_decryption](https://www.egovframe.go.kr/wiki/lib/exe/detail.php?id=egovframework%3Arte%3Afdl%3Aencryption_decryption&media=egovframework:rte:fdl:password.jpg)

## 5. bcrypt
`bcrypt`ëŠ” í•´ì‹œí•¨ìˆ˜ ì˜¤í”ˆì†ŒìŠ¤ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ `Salting`ê³¼ `Key Stretching`ì„ êµ¬í˜„í•œ í•´ì‰¬ í•¨ìˆ˜ì¤‘ ê°€ìž¥ ë„ë¦¬ ì‚¬ìš©ëœë‹¤. `bcrypt`ëŠ” ì•”í˜¸í™”ë¥¼ ìœ„í•´ ë‹¤ì–‘í•œ ì–¸ì–´ê°€ ì§€ì›ë˜ê³  ì‚¬ìš©ì´ ê°„íŽ¸í•˜ê¸° ë•Œë¬¸ì— ë§Žì´ ì‚¬ìš©ëœë‹¤. ë§Œì•½ `Salting`ê³¼ `Key Stretching`ì„ `bcrypt`ì—†ì´ êµ¬í˜„í•œë‹¤ê³  í•˜ë©´ ì–´ë–¤ `Salting`ì„ ë„£ì–´ì¤¬ëŠ”ì§€, `Key Stretching`ì„ ëª‡ë²ˆí–ˆëŠ”ì§€ ì–´ë–¤ ì•Œê³ ë¦¬ì¦˜ì„ ì¼ëŠ”ì§€ ëª¨ë‘ DBì— ì €ìž¥í•´ì•¼í•  ê²ƒì´ë‹¤. í•˜ì§€ë§Œ `bcrypt`ëŠ” í•´ì‰¬ ê²°ê³¼ê°’ì— ì†Œê¸ˆê°’ê³¼ í•´ì‹œê°’ ë° ë°˜ë³µíšŸìˆ˜ë¥¼ ê°™ì´ ë³´ê´€í•˜ê¸° ë•Œë¬¸ì— ìš°ë¦¬ëŠ” ì•”í˜¸í™”ëœ ê°’ë§Œ DBì— ì €ìž¥í•˜ë©´ ë˜ê¸° ë•Œë¬¸ì— ë¹„ë°€ë²ˆí˜¸ í•´ì‹±ì„ ì ìš©í•˜ëŠ”ë° ìžˆì–´ DBì„¤ê³„ë¥¼ ë³µìž¡í•˜ê²Œ í•  í•„ìš”ê°€ ì—†ë‹¤ëŠ” ìž¥ì ì´ ìžˆë‹¤. 

- **bcryptë¥¼ í†µí•´ í•´ì‹±ëœ ë‹¤ì´ì œìŠ¤íŠ¸**

![](https://images.velog.io/images/anjaekk/post/d6090924-6a11-4425-a97b-3a369d7ae2ff/image.png)

> ðŸ“ [ì´ë¯¸ì§€ ì¶œì²˜: Using PHP Native Password API with Magento](https://www.classyllama.com/blog/using-php-native-password-api-magento)

_\* saltê°’ì„ ì•Œê²Œë˜ë”ë¼ë„ ì›ë¬¸ íŒ¨ìŠ¤ì›Œë“œë¥¼ ëª¨ë¥´ë©´ í•´í‚¹í•  ìˆ˜ ì—†ë‹¤. _

## 6. bcrypt ì‚¬ìš© ì˜ˆì‹œ

- **bcryptë¥¼ ì‚¬ìš©í•˜ê¸°ì „ ì„¤ì¹˜ë¥¼ í•´ì¤€ë‹¤.**
```
pip install bcrypt
```

- **íŒŒì´ì¬ì„ ì´ìš©í•˜ì—¬ íŒ¨ìŠ¤ì›Œë“œë¥¼ ì•”í˜¸í™” í•´ë³´ìž.**
```
>>> import bcrypt
>>> password = '1234'

>>> bcrypt.hashpw(password, bcrypt.gensalt())
TypeError("Unicode-objects must be encoded before hashing")
```
ìœ„ì™€ ê°™ì´ ìž„ì˜ì˜ íŒ¨ìŠ¤ì›Œë“œë¥¼ `bcrypt`ë¥¼ ì´ìš©í•´ í•´ì‹±í•´ì¤¬ë”ë‹ˆ `TypeError`ê°€ ë°œìƒí–ˆë‹¤. ì—ëŸ¬ë¡œê·¸ë¥¼ í™•ì¸í•˜ë‹ˆ **"ìœ ë‹ˆì½”ë“œ ê°ì²´ëŠ” í•´ì‹±ì „ì— ì¸ì½”ë”© ë˜ì–´ì•¼ í•œë‹¤"**ë¼ê³  ë˜ì–´ìžˆë‹¤. 

> _**íŒŒì´ì¬ì˜ ì¸ì½”ë”©**: ë¬¸ìžì—´ì„ ë°”ì´íŠ¸ ì½”ë“œì¸ utf-8, ascii, euc-krí˜•ì‹ìœ¼ë¡œ ë³€í™˜(ë¬¸ìž -> ìˆ«ìž)_
> _**íŒŒì´ì¬ì˜ ë””ì½”ë”©**: utf-8, ascii, euc-krí˜•ì‹ì˜ ë°”ì´íŠ¸ ì½”ë“œë¥¼ ë¬¸ìžì—´ë¡œ ë³€í™˜(ìˆ«ìž -> ë¬¸ìž)_

- **ì¸ì½”ë”©(encoding) ê²°ê³¼**
```
>>> encoded_password=password.encode('utf-8')
>>> encoded_password
b'1234'

>>> type(encoded_password)
<class 'bytes'>
```
b'1234'ë¼ê³  ë°”ì´íŠ¸í™” ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìžˆë‹¤.

- **ë””ì½”ë”©(decoding) ê²°ê³¼**
```
>>> decoded_password = encoded_password.decode('utf-8')
'1234'
```
ë‹¤ì‹œ ë¬¸ìžì—´ì´ ë˜ì–´ ì¶œë ¥ëë‹¤.

- **ì¸ì½”ë”©í•˜ì—¬ í•´ì‹±**
```
>>> hassed_password=bcrypt.hashpw(password.encode('utf-8'), bcrypt.gensalt())
>>> hassed_password
b'$2b$12$Bqf0lzJqKpyBm8FphjoHyOrSzxoqerlta0Mqxvc6mDqQFJpq.1jVK'
```
`encode('utf-8')`ë¥¼ ì´ìš©í•˜ì—¬ ì¸ì½”ë”©ì„ í•´ì¤¬ë”ë‹ˆ ë‹¤ì´ì œìŠ¤íŠ¸(digest)ê°€ ìž˜ ìƒì„±ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìžˆë‹¤.

- **ì†”íŠ¸ê°’ ìƒì„±**
```
>>> bcrypt.gensalt()
b'$2b$12$./hCD6Q.YUY5T0TX6f46gO'
>>> bcrypt.gensalt()
b'$2b$12$jp3HSJdyG2WROFiMh4w7BO'
```
ì†”íŠ¸ ê°’ì€ ì‹¤í–‰í•  ë•Œë§ˆë‹¤ ëžœë¤í•œ ê°’ë“¤ì´ ìƒì„±ë˜ì–´ ë‚˜ì˜¨ë‹¤.

```
>>> salt = bcrypt.gensalt()
>>> salt
b'$2b$12$WBuLNTOVb2/mB7pYY4mmou'
```
ì†”íŠ¸ê°’ì„ ë³€ìˆ˜ì— ë‹´ì•„ ì €ìž¥í•´ì£¼ë„ë¡ í•œë‹¤.(ì‚¬ìš©í•  ë•ŒëŠ” ë³€ìˆ˜ì— ë‹´ì§€ ì•Šì•„ë„ ëœë‹¤.)

- **ì •í•´ì§„ ì†”íŠ¸ê°’ìœ¼ë¡œ í•´ì‹±**
```
>>> hashed_password = bcrypt.hashpw(password.encode('utf-8'), salt)
>>> hashed_password
b'$2b$12$WBuLNTOVb2/mB7pYY4mmoubar.55Id3WVqdVax9Lj.n9tpVqTKqXO'
>>> type(hashed_password)
<class 'bytes'>
```
ì´ë ‡ê²Œ í•´ì‰¬ëœ íŒ¨ìŠ¤ì›Œë“œ ê°’ì„ ë””ì½”ë“œí•˜ì—¬ DBì— ì €ìž¥í•˜ë„ë¡ í•œë‹¤. 

- **ë¡œê·¸ì¸ì‹œ íŒ¨ìŠ¤ì›Œë“œ í™•ì¸**

```
>>> bcrypt.checkpw('1234'.encode('utf-8'), hashed_password)
True
>>> bcrypt.checkpw('123'.encode('utf-8'), hashed_password)
False
```
`checkpw`ëŠ” ë§ ê·¸ëŒ€ë¡œ ì‚¬ìš©ìžê°€ ë¡œê·¸ì¸ì„ í•  ë•Œ ê³„ì •ê³¼ íŒ¨ìŠ¤ì›Œë“œê°€ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸í•˜ëŠ” ê²ƒì´ë‹¤. ê³µì‹ë¬¸ì„œì— ë‚˜ì™€ìžˆë“¯ì´ ì²«ë²ˆì§¸ ì¸ìžë¡œ ì‚¬ìš©ìžê°€ ìž…ë ¥í•œ íŒ¨ìŠ¤ì›Œë“œë¥¼, ë‘ë²ˆì§¸ ì¸ìžë¡œ í•´ì‰¬ëœ ê°’ì„ ë„£ì–´ì£¼ë©´ ëœë‹¤.
```
>>> if bcrypt.checkpw(password, hashed):
...     print("It Matches!")
... else:
...     print("It Does not Match :(")
```
ì£¼ì˜í•  ì ì€ DBì— í•´ì‰¬ëœ íŒ¨ìŠ¤ì›Œë“œë¥¼ ë””ì½”ë“œí•˜ì—¬ ë„£ì–´ì¤¬ê¸° ë•Œë¬¸ì— íŒ¨ìŠ¤ì›Œë“œ í™•ì¸ì‹œ ë‹¤ì‹œ ì¸ì½”ë”©í•˜ì—¬ í™•ì¸í•´ì•¼í•œë‹¤.

> ì°¸ì¡°
>
>ðŸ”— [stranger's LAB ë¸”ë¡œê·¸ | íŒ¨ìŠ¤ì›Œë“œì˜ ì•”í˜¸í™”ì™€ ì €ìž¥ - Hash(í•´ì‹œ)ì™€ Salt(ì†”íŠ¸)](https://st-lab.tistory.com/100)
>
>ðŸ”— [Project description | bcrypt](https://pypi.org/project/bcrypt/)

