# Cache

### μΊμ‹ μ‚¬μ© μ΄μ 

μΊμ‹λ¥Ό μ‚¬μ©ν•μ§€ μ•λ” κ²½μ°, λ°μ΄ν„°κ°€ λ³€κ²½λμ§€ μ•μ•λ”λ°λ„ λ¶κµ¬ν•κ³  κ³„μ† λ„¤νΈμ›ν¬λ¥Ό ν†µν•΄ μ„λ²„μ—μ„ λ°μ΄ν„°λ¥Ό λ‹¤μ΄λ°›μ•„μ•Όν•λ‹¤. μ΄λ ‡κ² λλ©΄ μΈν„°λ„· λ„¤νΈμ›ν¬λ” λλ¦¬κ³  λΉ„μ‹ΈκΈ° λ•λ¬Έμ— λ¶ν•„μ”ν• μμ›μ„ λ‚­λΉ„ν•κ² λλ‹¤. λν• λ‹¤μ΄λ΅λ“λ΅ μΈν• λΈλΌμ°μ € λ΅λ”©μ†λ„λ„ λλ ¤ λλ¦° μ‚¬μ©μκ²½ν—μ„ μ κ³µν•κ² λλ‹¤. 

<br/>

### κ²€μ¦ν—¤λ”μ™€ μ΅°κ±΄λ¶€ μ”μ²­

- κ²€μ¦ν—¤λ”: μ„λ²„ β†’ ν΄λΌμ΄μ–ΈνΈ μ—κ² μ „μ†΅
    - Last-Modified(λ°μ΄ν„°μ μµμΆ…μμ •μΌ)
    - Etag(κ³ μ  λ²„μ „)
- μ΅°κ±΄λ¶€ μ”μ²­: ν΄λΌμ΄μ–ΈνΈ β†’ μ„λ²„λ΅ μ”μ²­μ„ λ³΄λ‚Ό λ• μ΅°κ±΄μ„ λ‹¤λ” κ²ƒμΌλ΅ μ„λ²„μ λ°μ΄ν„° μμ •μΌμ΄ μ”μ²­κ³Ό ν•¨κ» λ³΄λ‚Έ λ‚ μ§μ™€ λ™μΌν•μ§€ μ„λ²„κ°€ ν™•μΈν•  μ μλ„λ΅ μ”μ²­μ„ λ³΄λ‚΄λ” κ²ƒμ΄λ‹¤.
    - If-Modified-Since(Last-Modifiedμ™€ ν•¨κ» μ‚¬μ©)
    - If-None-Match(Etagμ™€ ν•¨κ» μ‚¬μ©)

μΊμ‹λ” μ΄λ¬ν• κ²€μ¦ν—¤λ”μ™€ μ΅°κ±΄λ¶€ μ”μ²­μ„ μ΄μ©ν•΄ μΊμ‹ μ ν¨κΈ°κ°„μ΄ μ΄κ³Όν•λ”λΌλ„ μ„λ²„μ λ°μ΄ν„°κ°€ κ°±μ‹ λμ§€ μ•μΌλ©΄ λ³„λ„μ λ³€κ²½λμ§€ μ•μ€ λ°μ΄ν„°(Body)λ¥Ό μ μ™Έν• λ©”νƒ€μ •λ³΄λ§ λ‹΄κΈ΄ headerλ¥Ό μ‘λ‹µν•κΈ° λ•λ¬Έμ— ν΄λΌμ΄μ–ΈνΈλ” μΊμ‹μ— μ €μ¥λμ–΄μλ” λ°μ΄ν„°λ¥Ό μ¬ν™μ©ν•  μ μμΌλ©° μ΄λ¥Ό ν†µν•΄ λ¬Όλ΅  ν—¤λ”μ λ‚΄μ©μΌλ΅ μΈν• λ„¤νΈμ›ν¬ λ‹¤μ΄λ΅λ“κ°€ λ°μƒν•κΈ΄ ν•μ§€λ§ λ§¤μ° μ μ€ μ©λ‰μΌλ΅ λ„¤νΈμ›ν¬λ¥Ό μ‚¬μ©ν•  μ μκ² λλ‹¤.

Last-Modifiedμ™€ If-Modified-Sinceλ” λ‚ μ§λ¥Ό ν†µν•΄ λ°μ΄ν„°κ°€ λ³€κ²½λμ—λ”μ§€ ν™•μΈν•λ”λ° μ΄λ” μ΄λ‹¨μ„λ΅ λ°–μ— ν™•μΈν•  μ μ—†μ–΄ μ΄ λ―Έλ§λ‹¨μ„λ΅λ” μΊμ‹ μ΅°μ •μ΄ λ¶κ°€λ¥ν•κ² λλ‹¤. λν• λ°μ΄ν„°λ¥Ό μμ •ν•΄μ„ λ‚ μ§λ§ λ‹¤λ¥΄κ³  λ°μ΄ν„°λ” λ™μΌν• κ²½μ°λ¥Ό κ±Έλ¬λ‚Ό μ μ—†κ²λλ‹¤. 

ν•μ§€λ§ Etagμ™€ If-None-Matchλ” λ°μ΄ν„°μ— μ„μμ κµμ ν• λ²„μ „μ΄λ¦„μ„ λ‹¬μ•„λ‘ μΌλ΅μ¨ μ„λ²„μ—μ„ μ¤νμ΄μ¤λ‚ μ£Όμ„μ²λΌ μλ―Έκ°€ μ—†λ‹¤κ³  μƒκ°λλ” λ°μ΄ν„° λ³€ν™”μ— λ€ν•΄μ„λ” μ‹ κ²½μ“°μ§€ μ•λ„λ΅ ν•λ” κ²ƒμ²λΌ λ³„λ„μ μΊμ‹λ΅μ§μ„ κ΄€λ¦¬ν•  μ μκ² λλ‹¤.(μΊμ‹ μ μ–΄ λ΅μ§μ„ μ„λ²„μ—μ„ μ™„μ „ν κ΄€λ¦¬κ°€λ¥) λ°μ΄ν„°κ°€ λ³€κ²½λλ©΄ μ„λ²„κ°€ νƒκ·Έλ¥Ό λ³€κ²½ν•΄ μ‘λ‹µν•κ³  ν΄λΌμ΄μ–ΈνΈλ” νƒκ·Έ λ³€κ²½μ‚¬ν•­λ§ ν™•μΈν•λ©΄ λλ‹¤.

<br/>

### μΊμ‹ ν”„λ΅μ„Έμ¤(Last-Modifiedμ™€ If-Modified-Since μ‚¬μ©μ‹)

1. ν΄λΌμ΄μ–ΈνΈ μ”μ²­μ— μ„λ²„μ—μ„ μΊμ‹μ— κ΄€ν• μ •λ³΄λ¥Ό ν—¤λ”λ΅ μ‘λ‹µκ³Ό ν•¨κ» λ°ν™
- cache-control: max-age=60
    - 60μ΄ λ™μ• μΊμ‹κ°€ μ ν¨ν•λ‹¤.
- Last-Modified: λ‚ μ§(κ²€μ¦ν—¤λ”)
    - λ°μ΄ν„°μ μµμΆ… μμ •μΌ
2. λΈλΌμ°μ €λ” μΊμ‹ μ €μ¥μ†μ— μ‘λ‹µκ²°κ³Όλ¥Ό μΊμ‹ μ ν¨μ‹κ°„μΈ 60μ΄κ°„ κ²€μ¦ν—¤λ”μ™€ ν•¨κ» λ°μ΄ν„°λ¥Ό μ €μ¥ν•κ² λλ‹¤.  
3. κ·Έ ν›„ λΈλΌμ°μ €λ” λ¨λ“  μ‘λ‹µμ„ λ³΄λ‚΄κΈ°μ „ μΊμ‹ μ €μ¥μ†λ¥Ό μ΅°νν•κ³  ν•΄λ‹Ή λ‚΄μ©μ΄ μΊμ‹ μ €μ¥μ†μ— μμΌλ©΄ μ €μ¥μ†μ— μλ” λ‚΄μ©μ„ λ¨Όμ € μ‚¬μ©ν•κ² λλ‹¤. 
4. μ ν¨μ‹κ°„μΈ 60μ΄κ°€ μ§€λ‚κ² λλ©΄ λΈλΌμ°μ €κ°€ μ”μ²­μ„ λ³΄λ‚Όλ• κΈ°μ΅΄ μΊμ‹ μ €μ¥μ†μ—μ„ λ°μ΄ν„°μ™€ ν•¨κ» μ €μ¥λμ–΄μλ κ²€μ¦ν—¤λ” λ‚΄μ©μΈ **μ΅°κ±΄λ¶€ μ”μ²­**κ³Ό ν•¨κ» λ³΄λ‚΄κ² λλ‹¤.
- if-modified-since: λ‚ μ§
5. μ”μ²­μ„ λ°›μ€ μ„λ²„λ” μ΅°κ±΄λ¶€ μ”μ²­κ³Ό λ°μ΄ν„° μµμΆ… μμ •μΌμ„ λΉ„κµν•κ² λλ‹¤.
- λ°μ΄ν„°κ°€ λ³€κ²½λμ—μ„ κ²½μ°
    - μƒλ΅μ΄ λ°μ΄ν„°λ¥Ό μ „μ†΅ν•΄μ¤€λ‹¤.
- λ°μ΄ν„°κ°€ λ³€κ²½λμ§€ μ•μ•μ„ κ²½μ°
    - Status codeμΈ 304 Not Modified μ „μ†΅
    - HTTP body μ—†μ΄ μ „μ†΅(μμ €λ κ² μ—†κΈ° λ•λ¬Έμ—, ν—¤λ”λ§ μ „μ†΅λκΈ° λ•λ¬Έμ— λ„¤νΈμ›ν¬ λ¶€ν•κ°€ κ°μ†ν•κ² λλ‹¤.)

<br/>

### Cache-Control
μ΅°κ±΄λ¶€ μ”μ²­κ³Ό κ΄€λ ¨λ header
- max-age: μΊμ‹ μ ν¨μ‹κ°„(μ΄)
- no-cache: λ°μ΄ν„°λ” μΊμ‹ν•΄λ„ λμ§€λ§, ν•­μƒ μΊμ‹λ¥Ό μ‚¬μ©ν•κΈ° μ „μ— ν”„λ΅μ‹ μ„λ²„κ°€ μ•„λ‹ μ›μ„λ²„(origin)μ— If-Modified-Sinceμ™€ κ°™μ΄ κ²€μ¦ ν›„ μ‚¬μ©
- no-store: λ°μ΄ν„°μ— λ―Όκ°„ν•¨ μ •λ³΄κ°€ μμΌλ―€λ΅ μ €μ¥ν•λ©΄ μ•λ¨(λ©”λ¨λ¦¬μ—μ„ μ‚¬μ©ν•κ³  μµλ€ν• λΉ¨λ¦¬ μ‚¬μ©) 

<br/>

### ν”„λ΅μ‹ μΊμ‹
ν”„λ΅μ‹ μΊμ‹λ” μ‘λ‹µμ‹κ°„μ„ μ¤„μ΄κΈ° μ„ν•΄ μ›μ„λ²„μ™€ ν΄λΌμ΄μ–ΈνΈ μ‚¬μ΄μ— μ΅΄μ¬ν•λ” μ„λ²„μ΄λ‹¤. μ—¬κΈ°μ„ ν΄λΌμ΄μ–ΈνΈμ—μ„ μ‚¬μ©ν•κ³  μ €μ¥ν•λ” μΊμ‹λ¥Ό private cacheλΌκ³  ν•λ©° ν”„λ΅μ‹ μΊμ‹λ¥Ό public cacheλΌκ³  ν•λ‹¤. 
![](https://images.velog.io/images/anjaekk/post/015dfdad-4191-4a70-9b9b-97bb3eb1ce04/image.png)
> π“‚ [Image Source-wikipedia](https://en.wikipedia.org/wiki/Reverse_proxy)

<br/>

### μΊμ‹ λ¬΄ν¨ν™”
μΊμ‹λ¥Ό μ μ©ν•μ§€ μ•λ”λΌλ„ μ›Ή λΈλΌμ°μ €λ“¤μ΄ μ„μλ΅ μΊμ‹λ¥Ό μ €μ¥ν•κΈ°λ„ν•λ‹¤. κ·Έλ¬λ―€λ΅ μΊμ‹κ°€ λμ–΄μ„  μ•λλ” λ¶€λ¶„μ€ headerμ— μ•„λμ λ‚΄μ©μ„ λ¨λ‘ λ„£μ–΄ ν™•μ‹¤ν λ…μ‹λ¥Ό ν•΄μ¤μ•Ό ν•λ‹¤.
- Cache-Control: no-cache, no-store, must-revalidate
- Pragma: no-cache(HTTP 1.0ν•μ„ νΈν™λ¬ΈμΌλ΅ νΉμ‹λ‚ λ¨λ¥Ό ν•μ„λ²„μ „μ κ²½μ°λ¥Ό λ€λΉ„ν•μ—¬ ν•¨κ» λ„£μ–΄μ¤€λ‹¤.)
